#!/usr/bin/env ruby

require "curb"
require "thor"
require "yaml"

class AnnoyingWifi < Thor

  desc "login", "Logs you in to the wifi"
  option :user
  option :password
  def login
  	while true
      username = options[:user]
      password = options[:password]
	  	say "Attempting login with #{username} / #{"*"*password.length}"
	    req = Curl::Easy.http_post("https://controller.mobile.lan/portal_api.php", "action=authenticate&login=#{username}&password=#{password}")

		  if req.body_str =~ /errorMessage/
		    puts "Wrong user name/password" 
		  elsif req.body_str =~ /expired/
		    puts "Looks like your username/password expired" 
		  else
			  say "Hooray, you are now logged in!"
			  break
		  end
	  end
  end

end

AnnoyingWifi.start
